"use strict";
/**
 * Created by user on 2018/1/30/030.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const grammer_1 = require("./grammer");
let index = 1;
let cgs = {};
function _resetCache() {
    index = 1;
    cgs = {};
}
exports._resetCache = _resetCache;
function parse(str) {
    if (str instanceof RegExp) {
        str = str.source;
    }
    if (typeof str != 'string') {
        let ex = new TypeError('The regexp to parse must be represented as a string.');
        throw ex;
    }
    //capture group index
    _resetCache();
    return grammer_1.parse(str);
}
exports.parse = parse;
var types;
(function (types) {
    types.CONTROL_CHARACTER = 'control-character';
    types.BACK_REFERENCE = 'back-reference';
    types.ALTERNATE = 'alternate';
    types.MATCH = 'match';
    types.CAPTURE_GROUP = 'capture-group';
    types.QUANTIFIED = 'quantified';
    types.QUANTIFIER = 'quantifier';
    types.CHARSET = 'charset';
    types.RANGE = 'range';
    types.CHARSET_RANGE = types.RANGE;
    types.LITERAL = 'literal';
    types.UNICODE = 'unicode';
    types.HEX = 'hex';
    types.OCTAL = 'octal';
    types.NEGATIVE_LOOKAHEAD = 'negative-lookahead';
    types.POSITIVE_LOOKAHEAD = 'positive-lookahead';
    types.NON_CAPTURE_GROUP = 'non-capture-group';
})(types = exports.types || (exports.types = {}));
class Token {
    constructor(type, obj) {
        this.type = type;
        this.offset = Token.offset();
        this.text = Token.text();
    }
    toString(update) {
        return this.text;
    }
}
exports.Token = Token;
(function (Token) {
})(Token = exports.Token || (exports.Token = {}));
class Alternate extends Token {
    constructor(left, right) {
        super(types.ALTERNATE);
        this.left = left;
        this.right = right;
    }
}
exports.Alternate = Alternate;
class Match extends Token {
    constructor(body) {
        super(types.MATCH);
        this.body = body.filter(Boolean);
    }
}
exports.Match = Match;
class Group extends Token {
    constructor(type, body) {
        super(type);
        this.body = body;
    }
    toString(update) {
        switch (this.type) {
            case types.NON_CAPTURE_GROUP:
                return '(' + this.text + ')';
            case types.POSITIVE_LOOKAHEAD:
                return '(?=' + this.text + ')';
            case types.NEGATIVE_LOOKAHEAD:
                return '(?!' + this.text + ')';
            case types.CAPTURE_GROUP:
                return '(' + this.text + ')';
        }
        return super.toString(update);
    }
}
exports.Group = Group;
class CaptureGroup extends Group {
    constructor(body) {
        super(types.CAPTURE_GROUP);
        this.index = cgs[this.offset] || (cgs[this.offset] = index++);
        this.body = body;
    }
}
exports.CaptureGroup = CaptureGroup;
class Quantified extends Token {
    constructor(body, quantifier) {
        super(types.QUANTIFIED);
        this.body = body;
        this.quantifier = quantifier;
    }
}
exports.Quantified = Quantified;
class Quantifier extends Token {
    constructor(min, max) {
        super(types.QUANTIFIER);
        this.min = min;
        this.max = max;
        this.greedy = true; //initial setting
    }
}
exports.Quantifier = Quantifier;
class CharSet extends Token {
    constructor(invert, body) {
        super(types.CHARSET);
        this.invert = invert;
        this.body = body;
    }
    toString(update) {
        if (update) {
            let text = '';
            if (this.invert) {
                text += '^';
            }
            for (let a of this.body) {
                text += a.toString();
            }
            return `[${text}]`;
        }
        return super.toString(update);
    }
}
exports.CharSet = CharSet;
class CharacterRange extends Token {
    constructor(start, end) {
        super(types.RANGE);
        this.start = start;
        this.end = end;
    }
    setBody(arr) {
        let body_new = [];
        for (let s of arr) {
            //console.log(s);
            if (typeof s == 'string') {
                body_new.push(new Literal(s, true));
            }
            else if (s instanceof Literal) {
                body_new.push(s);
            }
            else {
                throw new RangeError();
            }
        }
        if (!body_new.length) {
            throw new ReferenceError();
        }
        this.body = body_new;
        this.start = this.body[0];
        this.end = this.body[this.body.length - 1];
        this.text = this.toString(true);
        return this;
    }
    toString(update) {
        if (update && this.body) {
            let text = '';
            for (let a of this.body) {
                text += a.toString();
            }
            return text;
        }
        return super.toString(update);
    }
    inspect() {
        return `CharacterRange(${this.start}-${this.end})`;
    }
}
exports.CharacterRange = CharacterRange;
class Literal extends Token {
    constructor(body, text = null) {
        super(types.LITERAL);
        if (typeof text == 'string' || text === true) {
            this.text = typeof text == 'string' ? text : body;
        }
        this.body = body;
    }
    get escaped() {
        return this.body != this.text;
    }
    inspect() {
        return `Literal(${this.text})`;
    }
}
exports.Literal = Literal;
class TokenChar extends Token {
    constructor(type, code) {
        super(type);
        this.code = code.toUpperCase();
    }
}
exports.TokenChar = TokenChar;
class Unicode extends TokenChar {
    constructor(code) {
        super(types.UNICODE, code);
    }
}
exports.Unicode = Unicode;
class Hex extends TokenChar {
    constructor(code) {
        super(types.HEX, code);
    }
}
exports.Hex = Hex;
class Octal extends TokenChar {
    constructor(code) {
        super(types.OCTAL, code);
    }
}
exports.Octal = Octal;
class BackReference extends TokenChar {
    constructor(code) {
        super(types.BACK_REFERENCE, code);
    }
}
exports.BackReference = BackReference;
class ControlCharacter extends TokenChar {
    constructor(code) {
        super(types.CONTROL_CHARACTER, code);
    }
}
exports.ControlCharacter = ControlCharacter;
exports.default = exports;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGliLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCx1Q0FBNEM7QUFFNUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FBQ2QsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0FBRWIsU0FBZ0IsV0FBVztJQUUxQixLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsR0FBRyxHQUFHLEVBQUUsQ0FBQztBQUNWLENBQUM7QUFKRCxrQ0FJQztBQUlELFNBQWdCLEtBQUssQ0FBQyxHQUFvQjtJQUV6QyxJQUFJLEdBQUcsWUFBWSxNQUFNLEVBQ3pCO1FBQ0MsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7S0FDakI7SUFDRCxJQUFJLE9BQU8sR0FBRyxJQUFJLFFBQVEsRUFDMUI7UUFDQyxJQUFJLEVBQUUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1FBQy9FLE1BQU0sRUFBRSxDQUFDO0tBQ1Q7SUFDRCxxQkFBcUI7SUFDckIsV0FBVyxFQUFFLENBQUM7SUFDZCxPQUFPLGVBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNwQixDQUFDO0FBZEQsc0JBY0M7QUFFRCxJQUFpQixLQUFLLENBc0JyQjtBQXRCRCxXQUFpQixLQUFLO0lBRVIsdUJBQWlCLEdBQUcsbUJBQW1CLENBQUM7SUFDeEMsb0JBQWMsR0FBRyxnQkFBZ0IsQ0FBQztJQUNsQyxlQUFTLEdBQUcsV0FBVyxDQUFDO0lBQ3hCLFdBQUssR0FBRyxPQUFPLENBQUM7SUFDaEIsbUJBQWEsR0FBRyxlQUFlLENBQUM7SUFDaEMsZ0JBQVUsR0FBRyxZQUFZLENBQUM7SUFDMUIsZ0JBQVUsR0FBRyxZQUFZLENBQUM7SUFDMUIsYUFBTyxHQUFHLFNBQVMsQ0FBQztJQUNwQixXQUFLLEdBQUcsT0FBTyxDQUFDO0lBQ2hCLG1CQUFhLEdBQUcsTUFBQSxLQUFLLENBQUM7SUFDdEIsYUFBTyxHQUFHLFNB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QUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0NBQ0Q7QUFWRCw4QkFVQztBQUVELE1BQWEsT0FBUSxTQUFRLFNBQVM7SUFFckMsWUFBWSxJQUFZO1FBRXZCLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7Q0FDRDtBQU5ELDBCQU1DO0FBRUQsTUFBYSxHQUFJLFNBQVEsU0FBUztJQUVqQyxZQUFZLElBQVk7UUFFdkIsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDeEIsQ0FBQztDQUNEO0FBTkQsa0JBTUM7QUFFRCxNQUFhLEtBQU0sU0FBUSxTQUFTO0lBRW5DLFlBQVksSUFBWTtRQUV2QixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMxQixDQUFDO0NBQ0Q7QUFORCxzQkFNQztBQUVELE1BQWEsYUFBYyxTQUFRLFNBQVM7SUFFM0MsWUFBWSxJQUFZO1FBRXZCLEtBQUssQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ25DLENBQUM7Q0FDRDtBQU5ELHNDQU1DO0FBRUQsTUFBYSxnQkFBaUIsU0FBUSxTQUFTO0lBRTlDLFlBQVksSUFBWTtRQUV2QixLQUFLLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUM7Q0FDRDtBQU5ELDRDQU1DO0FBRUQsa0JBQWUsT0FBaUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTgvMS8zMC8wMzAuXG4gKi9cblxuaW1wb3J0IHsgcGFyc2UgYXMgcGFyc2VyIH0gZnJvbSAnLi9ncmFtbWVyJztcblxubGV0IGluZGV4ID0gMTtcbmxldCBjZ3MgPSB7fTtcblxuZXhwb3J0IGZ1bmN0aW9uIF9yZXNldENhY2hlKClcbntcblx0aW5kZXggPSAxO1xuXHRjZ3MgPSB7fTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHN0cjogUmVnRXhwKTogTWF0Y2hcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShzdHI6IHN0cmluZyk6IE1hdGNoXG5leHBvcnQgZnVuY3Rpb24gcGFyc2Uoc3RyOiBzdHJpbmcgfCBSZWdFeHApOiBNYXRjaFxue1xuXHRpZiAoc3RyIGluc3RhbmNlb2YgUmVnRXhwKVxuXHR7XG5cdFx0c3RyID0gc3RyLnNvdXJjZTtcblx0fVxuXHRpZiAodHlwZW9mIHN0ciAhPSAnc3RyaW5nJylcblx0e1xuXHRcdGxldCBleCA9IG5ldyBUeXBlRXJyb3IoJ1RoZSByZWdleHAgdG8gcGFyc2UgbXVzdCBiZSByZXByZXNlbnRlZCBhcyBhIHN0cmluZy4nKTtcblx0XHR0aHJvdyBleDtcblx0fVxuXHQvL2NhcHR1cmUgZ3JvdXAgaW5kZXhcblx0X3Jlc2V0Q2FjaGUoKTtcblx0cmV0dXJuIHBhcnNlcihzdHIpO1xufVxuXG5leHBvcnQgbmFtZXNwYWNlIHR5cGVzXG57XG5cdGV4cG9ydCBjb25zdCBDT05UUk9MX0NIQVJBQ1RFUiA9ICdjb250cm9sLWNoYXJhY3Rlcic7XG5cdGV4cG9ydCBjb25zdCBCQUNLX1JFRkVSRU5DRSA9ICdiYWNrLXJlZmVyZW5jZSc7XG5cdGV4cG9ydCBjb25zdCBBTFRFUk5BVEUgPSAnYWx0ZXJuYXRlJztcblx0ZXhwb3J0IGNvbnN0IE1BVENIID0gJ21hdGNoJztcblx0ZXhwb3J0IGNvbnN0IENBUFRVUkVfR1JPVVAgPSAnY2FwdHVyZS1ncm91cCc7XG5cdGV4cG9ydCBjb25zdCBRVUFOVElGSUVEID0gJ3F1YW50aWZpZWQnO1xuXHRleHBvcnQgY29uc3QgUVVBTlRJRklFUiA9ICdxdWFudGlmaWVyJztcblx0ZXhwb3J0IGNvbnN0IENIQVJTRVQgPSAnY2hhcnNldCc7XG5cdGV4cG9ydCBjb25zdCBSQU5HRSA9ICdyYW5nZSc7XG5cdGV4cG9ydCBjb25zdCBDSEFSU0VUX1JBTkdFID0gUkFOR0U7XG5cdGV4cG9ydCBjb25zdCBMSVRFUkFMID0gJ2xpdGVyYWwnO1xuXG5cdGV4cG9ydCBjb25zdCBVTklDT0RFID0gJ3VuaWNvZGUnO1xuXHRleHBvcnQgY29uc3QgSEVYID0gJ2hleCc7XG5cdGV4cG9ydCBjb25zdCBPQ1RBTCA9ICdvY3RhbCc7XG5cblx0ZXhwb3J0IGNvbnN0IE5FR0FUSVZFX0xPT0tBSEVBRCA9ICduZWdhdGl2ZS1sb29rYWhlYWQnO1xuXHRleHBvcnQgY29uc3QgUE9TSVRJVkVfTE9PS0FIRUFEID0gJ3Bvc2l0aXZlLWxvb2thaGVhZCc7XG5cdGV4cG9ydCBjb25zdCBOT05fQ0FQVFVSRV9HUk9VUCA9ICdub24tY2FwdHVyZS1ncm91cCc7XG5cbn1cblxuZXhwb3J0IGNsYXNzIFRva2VuXG57XG5cdHB1YmxpYyB0eXBlOiBzdHJpbmc7XG5cdHB1YmxpYyBvZmZzZXQ6IG51bWJlcjtcblx0cHVibGljIHRleHQ6IHN0cmluZztcblxuXHRjb25zdHJ1Y3Rvcih0eXBlOiBzdHJpbmcsIG9iaj8pXG5cdHtcblx0XHR0aGlzLnR5cGUgPSB0eXBlO1xuXHRcdHRoaXMub2Zmc2V0ID0gVG9rZW4ub2Zmc2V0KCk7XG5cdFx0dGhpcy50ZXh0ID0gVG9rZW4udGV4dCgpO1xuXHR9XG5cblx0dG9TdHJpbmcodXBkYXRlPzogYm9vbGVhbilcblx0e1xuXHRcdHJldHVybiB0aGlzLnRleHQ7XG5cdH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBUb2tlblxue1xuXHRleHBvcnQgbGV0IG9mZnNldDogKCkgPT4gbnVtYmVyO1xuXHRleHBvcnQgbGV0IHRleHQ6ICgpID0+IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIEFsdGVybmF0ZSBleHRlbmRzIFRva2VuXG57XG5cdHB1YmxpYyBsZWZ0OiBUb2tlbjtcblx0cHVibGljIHJpZ2h0OiBUb2tlbjtcblxuXHRjb25zdHJ1Y3RvcihsZWZ0OiBUb2tlbiwgcmlnaHQ6IFRva2VuKVxuXHR7XG5cdFx0c3VwZXIodHlwZXMuQUxURVJOQVRFKTtcblxuXHRcdHRoaXMubGVmdCA9IGxlZnQ7XG5cdFx0dGhpcy5yaWdodCA9IHJpZ2h0O1xuXHR9XG59XG5cbmV4cG9ydCBjbGFzcyBNYXRjaCBleHRlbmRzIFRva2VuXG57XG5cdHB1YmxpYyBib2R5OiBUb2tlbltdO1xuXG5cdGNvbnN0cnVjdG9yKGJvZHkpXG5cdHtcblx0XHRzdXBlcih0eXBlcy5NQVRDSCk7XG5cblx0XHR0aGlzLmJvZHkgPSBib2R5LmZpbHRlcihCb29sZWFuKTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgR3JvdXAgZXh0ZW5kcyBUb2tlblxue1xuXHRwdWJsaWMgYm9keTogVG9rZW5bXTtcblxuXHRjb25zdHJ1Y3Rvcih0eXBlLCBib2R5Pylcblx0e1xuXHRcdHN1cGVyKHR5cGUpO1xuXG5cdFx0dGhpcy5ib2R5ID0gYm9keTtcblx0fVxuXG5cdHRvU3RyaW5nKHVwZGF0ZT86IGJvb2xlYW4pXG5cdHtcblx0XHRzd2l0Y2ggKHRoaXMudHlwZSlcblx0XHR7XG5cdFx0XHRjYXNlIHR5cGVzLk5PTl9DQVBUVVJFX0dST1VQOlxuXHRcdFx0XHRyZXR1cm4gJygnICsgdGhpcy50ZXh0ICsgJyknO1xuXHRcdFx0Y2FzZSB0eXBlcy5QT1NJVElWRV9MT09LQUhFQUQ6XG5cdFx0XHRcdHJldHVybiAnKD89JyArIHRoaXMudGV4dCArICcpJztcblx0XHRcdGNhc2UgdHlwZXMuTkVHQVRJVkVfTE9PS0FIRUFEOlxuXHRcdFx0XHRyZXR1cm4gJyg/IScgKyB0aGlzLnRleHQgKyAnKSc7XG5cdFx0XHRjYXNlIHR5cGVzLkNBUFRVUkVfR1JPVVA6XG5cdFx0XHRcdHJldHVybiAnKCcgKyB0aGlzLnRleHQgKyAnKSc7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHN1cGVyLnRvU3RyaW5nKHVwZGF0ZSk7XG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIENhcHR1cmVHcm91cCBleHRlbmRzIEdyb3VwXG57XG5cdHB1YmxpYyBpbmRleDogbnVtYmVyO1xuXG5cdGNvbnN0cnVjdG9yKGJvZHkpXG5cdHtcblx0XHRzdXBlcih0eXBlcy5DQVBUVVJFX0dST1VQKTtcblxuXHRcdHRoaXMuaW5kZXggPSBjZ3NbdGhpcy5vZmZzZXRdIHx8IChjZ3NbdGhpcy5vZmZzZXRdID0gaW5kZXgrKyk7XG5cdFx0dGhpcy5ib2R5ID0gYm9keTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgUXVhbnRpZmllZCBleHRlbmRzIFRva2VuXG57XG5cdHB1YmxpYyBib2R5OiBUb2tlbjtcblx0cHVibGljIHF1YW50aWZpZXI6IFF1YW50aWZpZXI7XG5cblx0Y29uc3RydWN0b3IoYm9keSwgcXVhbnRpZmllcjogUXVhbnRpZmllcilcblx0e1xuXHRcdHN1cGVyKHR5cGVzLlFVQU5USUZJRUQpO1xuXG5cdFx0dGhpcy5ib2R5ID0gYm9keTtcblx0XHR0aGlzLnF1YW50aWZpZXIgPSBxdWFudGlmaWVyO1xuXHR9XG59XG5cbmV4cG9ydCBjbGFzcyBRdWFudGlmaWVyIGV4dGVuZHMgVG9rZW5cbntcblx0cHVibGljIG1pbjogbnVtYmVyO1xuXHRwdWJsaWMgbWF4OiBudW1iZXI7XG5cdHB1YmxpYyBncmVlZHk6IGJvb2xlYW47XG5cblx0Y29uc3RydWN0b3IobWluOiBudW1iZXIsIG1heDogbnVtYmVyKVxuXHR7XG5cdFx0c3VwZXIodHlwZXMuUVVBTlRJRklFUik7XG5cblx0XHR0aGlzLm1pbiA9IG1pbjtcblx0XHR0aGlzLm1heCA9IG1heDtcblx0XHR0aGlzLmdyZWVkeSA9IHRydWU7IC8vaW5pdGlhbCBzZXR0aW5nXG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIENoYXJTZXQgZXh0ZW5kcyBUb2tlblxue1xuXHRwdWJsaWMgaW52ZXJ0O1xuXHRwdWJsaWMgYm9keTogKExpdGVyYWwgfCBDaGFyYWN0ZXJSYW5nZSlbXTtcblxuXHRjb25zdHJ1Y3RvcihpbnZlcnQsIGJvZHkpXG5cdHtcblx0XHRzdXBlcih0eXBlcy5DSEFSU0VUKTtcblxuXHRcdHRoaXMuaW52ZXJ0ID0gaW52ZXJ0O1xuXHRcdHRoaXMuYm9keSA9IGJvZHk7XG5cdH1cblxuXHR0b1N0cmluZyh1cGRhdGU/OiBib29sZWFuKVxuXHR7XG5cdFx0aWYgKHVwZGF0ZSlcblx0XHR7XG5cdFx0XHRsZXQgdGV4dCA9ICcnO1xuXG5cdFx0XHRpZiAodGhpcy5pbnZlcnQpXG5cdFx0XHR7XG5cdFx0XHRcdHRleHQgKz0gJ14nO1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGxldCBhIG9mIHRoaXMuYm9keSlcblx0XHRcdHtcblx0XHRcdFx0dGV4dCArPSBhLnRvU3RyaW5nKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBgWyR7dGV4dH1dYDtcblx0XHR9XG5cblx0XHRyZXR1cm4gc3VwZXIudG9TdHJpbmcodXBkYXRlKTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgQ2hhcmFjdGVyUmFuZ2UgZXh0ZW5kcyBUb2tlblxue1xuXHRwdWJsaWMgc3RhcnQ6IExpdGVyYWw7XG5cdHB1YmxpYyBlbmQ6IExpdGVyYWw7XG5cblx0cHVibGljIGJvZHk/OiBMaXRlcmFsW107XG5cblx0Y29uc3RydWN0b3Ioc3RhcnQ6IExpdGVyYWwsIGVuZDogTGl0ZXJhbClcblx0e1xuXHRcdHN1cGVyKHR5cGVzLlJBTkdFKTtcblxuXHRcdHRoaXMuc3RhcnQgPSBzdGFydDtcblx0XHR0aGlzLmVuZCA9IGVuZDtcblx0fVxuXG5cdHNldEJvZHkoYXJyOiBBcnJheTxMaXRlcmFsIHwgc3RyaW5nPilcblx0e1xuXHRcdGxldCBib2R5X25ldzogTGl0ZXJhbFtdID0gW107XG5cblx0XHRmb3IgKGxldCBzIG9mIGFycilcblx0XHR7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHMpO1xuXHRcdFx0aWYgKHR5cGVvZiBzID09ICdzdHJpbmcnKVxuXHRcdFx0e1xuXHRcdFx0XHRib2R5X25ldy5wdXNoKG5ldyBMaXRlcmFsKHMsIHRydWUpKTtcblx0XHRcdH1cblx0XHRcdGVsc2UgaWYgKHMgaW5zdGFuY2VvZiBMaXRlcmFsKVxuXHRcdFx0e1xuXHRcdFx0XHRib2R5X25ldy5wdXNoKHMpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHR0aHJvdyBuZXcgUmFuZ2VFcnJvcigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICghYm9keV9uZXcubGVuZ3RoKVxuXHRcdHtcblx0XHRcdHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigpO1xuXHRcdH1cblxuXHRcdHRoaXMuYm9keSA9IGJvZHlfbmV3O1xuXG5cdFx0dGhpcy5zdGFydCA9IHRoaXMuYm9keVswXTtcblx0XHR0aGlzLmVuZCA9IHRoaXMuYm9keVt0aGlzLmJvZHkubGVuZ3RoIC0gMV07XG5cblx0XHR0aGlzLnRleHQgPSB0aGlzLnRvU3RyaW5nKHRydWUpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHR0b1N0cmluZyh1cGRhdGU/OiBib29sZWFuKVxuXHR7XG5cdFx0aWYgKHVwZGF0ZSAmJiB0aGlzLmJvZHkpXG5cdFx0e1xuXHRcdFx0bGV0IHRleHQgPSAnJztcblxuXHRcdFx0Zm9yIChsZXQgYSBvZiB0aGlzLmJvZHkpXG5cdFx0XHR7XG5cdFx0XHRcdHRleHQgKz0gYS50b1N0cmluZygpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGV4dDtcblx0XHR9XG5cblx0XHRyZXR1cm4gc3VwZXIudG9TdHJpbmcodXBkYXRlKTtcblx0fVxuXG5cdGluc3BlY3QoKVxuXHR7XG5cdFx0cmV0dXJuIGBDaGFyYWN0ZXJSYW5nZSgke3RoaXMuc3RhcnR9LSR7dGhpcy5lbmR9KWA7XG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIExpdGVyYWwgZXh0ZW5kcyBUb2tlblxue1xuXHRwdWJsaWMgYm9keTogc3RyaW5nO1xuXG5cdGNvbnN0cnVjdG9yKGJvZHk6IHN0cmluZywgdGV4dDogc3RyaW5nIHwgdHJ1ZSA9IG51bGwpXG5cdHtcblx0XHRzdXBlcih0eXBlcy5MSVRFUkFMKTtcblxuXHRcdGlmICh0eXBlb2YgdGV4dCA9PSAnc3RyaW5nJyB8fCB0ZXh0ID09PSB0cnVlKVxuXHRcdHtcblx0XHRcdHRoaXMudGV4dCA9IHR5cGVvZiB0ZXh0ID09ICdzdHJpbmcnID8gdGV4dCA6IGJvZHk7XG5cdFx0fVxuXG5cdFx0dGhpcy5ib2R5ID0gYm9keTtcblx0fVxuXG5cdGdldCBlc2NhcGVkKCk6IGJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLmJvZHkgIT0gdGhpcy50ZXh0O1xuXHR9XG5cblx0aW5zcGVjdCgpXG5cdHtcblx0XHRyZXR1cm4gYExpdGVyYWwoJHt0aGlzLnRleHR9KWA7XG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIFRva2VuQ2hhciBleHRlbmRzIFRva2VuXG57XG5cdHB1YmxpYyBjb2RlOiBzdHJpbmc7XG5cblx0Y29uc3RydWN0b3IodHlwZTogc3RyaW5nLCBjb2RlOiBzdHJpbmcpXG5cdHtcblx0XHRzdXBlcih0eXBlKTtcblxuXHRcdHRoaXMuY29kZSA9IGNvZGUudG9VcHBlckNhc2UoKTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgVW5pY29kZSBleHRlbmRzIFRva2VuQ2hhclxue1xuXHRjb25zdHJ1Y3Rvcihjb2RlOiBzdHJpbmcpXG5cdHtcblx0XHRzdXBlcih0eXBlcy5VTklDT0RFLCBjb2RlKTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgSGV4IGV4dGVuZHMgVG9rZW5DaGFyXG57XG5cdGNvbnN0cnVjdG9yKGNvZGU6IHN0cmluZylcblx0e1xuXHRcdHN1cGVyKHR5cGVzLkhFWCwgY29kZSk7XG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIE9jdGFsIGV4dGVuZHMgVG9rZW5DaGFyXG57XG5cdGNvbnN0cnVjdG9yKGNvZGU6IHN0cmluZylcblx0e1xuXHRcdHN1cGVyKHR5cGVzLk9DVEFMLCBjb2RlKTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgQmFja1JlZmVyZW5jZSBleHRlbmRzIFRva2VuQ2hhclxue1xuXHRjb25zdHJ1Y3Rvcihjb2RlOiBzdHJpbmcpXG5cdHtcblx0XHRzdXBlcih0eXBlcy5CQUNLX1JFRkVSRU5DRSwgY29kZSk7XG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbnRyb2xDaGFyYWN0ZXIgZXh0ZW5kcyBUb2tlbkNoYXJcbntcblx0Y29uc3RydWN0b3IoY29kZTogc3RyaW5nKVxuXHR7XG5cdFx0c3VwZXIodHlwZXMuQ09OVFJPTF9DSEFSQUNURVIsIGNvZGUpO1xuXHR9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGV4cG9ydHMgYXMgdHlwZW9mIGltcG9ydCgnLi9saWInKTtcbiJdfQ==